<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Magic âœ¨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #fdf2f8; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; min-height: 100vh; margin: 0; overflow: hidden; padding-top: 15px; box-sizing: border-box; }
        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ff4081; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        .counter { font-size: 18px; color: #ad1457; margin-bottom: 8px; font-weight: bold; }
        .card { width: 300px; height: 360px; background: white; border-radius: 40px; box-shadow: 0 15px 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; justify-content: center; border: 10px solid #fbcfe8; transition: all 0.4s; position: relative; }
        .listening-active { border-color: #3b82f6 !important; box-shadow: 0 0 25px rgba(59, 130, 246, 0.6); }
        .emoji { font-size: 85px; margin-bottom: 10px; }
        .en-word { font-size: 26px; font-weight: 900; color: #be185d; direction: ltr; text-align: center; padding: 0 10px; }
        .transcript { margin-top: 10px; color: #3b82f6; font-weight: bold; min-height: 24px; font-size: 18px; }
        .controls { margin-top: 20px; display: flex; gap: 15px; align-items: center; direction: ltr; margin-bottom: 15px; }
        .btn { border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; box-shadow: 0 6px 0 #db2777; border-radius: 20px; outline: none; }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .nav-btn { width: 65px; height: 65px; background: #f472b6; font-size: 35px; }
        .mic-btn { width: 85px; height: 85px; background: #3b82f6; border-radius: 50%; font-size: 40px; box-shadow: 0 8px 0 #1d4ed8; }
        .mic-btn.is-listening { background: #fbbf24; box-shadow: 0 8px 0 #d97706; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="start-overlay">
        <h1 style="font-size: 40px; margin-bottom: 20px;">××•×›× ×•×ª? ğŸˆ</h1>
        <button class="btn" style="padding: 20px 50px; font-size: 25px; background: white; color: #ff4081; box-shadow: 0 6px 0 #ad1457;" onclick="startGame()">×œ×—×¦×• ×œ×”×ª×—×œ×”!</button>
    </div>

    <div class="counter" id="counter">1 / 42</div>

    <div class="card" id="main-card">
        <div class="emoji" id="display-emoji">ğŸ‘‹</div>
        <div class="en-word" id="display-en">Welcome</div>
        <div class="transcript" id="transcript-text"></div>
    </div>

    <div class="controls">
        <button class="btn nav-btn" onclick="prevWord()">â¬…ï¸</button>
        <button id="mic-button" class="btn mic-btn" onclick="toggleMic()">ğŸ¤</button>
        <button class="btn nav-btn" onclick="nextWord()">â¡ï¸</button>
    </div>

    <script>
        const words = [
            { en: 'Welcome', icon: 'ğŸ‘‹' }, { en: 'Hello', icon: 'ğŸ˜Š' }, { en: 'Good afternoon', icon: 'â˜€ï¸' },
            { en: 'Thank you', icon: 'ğŸ™' }, { en: "What's your name?", icon: 'â“' }, { en: 'My name is', icon: 'ğŸ†”' },
            { en: 'Sunday', icon: 'ğŸ“…' }, { en: 'Yes', icon: 'âœ…' }, { en: 'No', icon: 'âŒ' },
            { en: 'OK', icon: 'ğŸ†—' }, { en: 'Goodbye', icon: 'ğŸ‘‹' }, { en: 'How are you today?', icon: 'ğŸ’–' },
            { en: "Thank you I'm Ok", icon: 'ğŸ‘' }, { en: 'I love you', icon: 'ğŸ¤Ÿ' }, { en: 'Red', icon: 'â™¥ï¸' },
            { en: 'Green', icon: 'ğŸ’š' }, { en: 'Pink', icon: 'ğŸ’—' }, { en: 'Blue', icon: 'ğŸ’™' },
            { en: 'Light blue', icon: 'ğŸ©µ' }, { en: 'Orange', icon: 'ğŸ§¡' }, { en: 'Gray', icon: 'ğŸ”˜' },
            { en: 'Brown', icon: 'ğŸ¤' }, { en: 'Purple', icon: 'ğŸ’œ' }, { en: 'White', icon: 'ğŸ¤' },
            { en: 'Black', icon: 'ğŸ–¤' }, { en: 'Cat', icon: 'ğŸˆ' }, { en: 'Dog', icon: 'ğŸ•' },
            { en: 'Monkey', icon: 'ğŸ’' }, { en: 'Frog', icon: 'ğŸ¸' }, { en: 'Snake', icon: 'ğŸ' },
            { en: 'Rabbit', icon: 'ğŸ°' }, { en: 'Cow', icon: 'ğŸ„' }, { en: 'Fish', icon: 'ğŸŸ' },
            { en: 'Shark', icon: 'ğŸ¦ˆ' }, { en: 'Dreidel', icon: 'ğŸ•' }, { en: 'Dance', icon: 'ğŸ’ƒ' },
            { en: 'Jump', icon: 'ğŸ¦˜' }, { en: 'Stop', icon: 'ğŸ›‘' }, { en: 'Party', icon: 'ğŸ‰' }, { en: 'Light', icon: 'ğŸ’¡' }
        ];

        let currentIndex = 0;
        let isProcessing = false;
        let hasSucceeded = false;
        let recognition;

        // ××ª×—×•×œ ×× ×•×¢ ×–×™×”×•×™ ×”×“×™×‘×•×¨
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.interimResults = true;
            recognition.continuous = true;

            recognition.onstart = () => {
                isProcessing = true;
                document.getElementById('mic-button').classList.add('is-listening');
                document.getElementById('main-card').classList.add('listening-active');
            };

            recognition.onresult = (event) => {
                if (hasSucceeded) return;
                let result = "";
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    result += event.results[i][0].transcript;
                }
                result = result.toLowerCase().trim();
                document.getElementById('transcript-text').innerText = result;
                
                const target = words[currentIndex].en.toLowerCase().replace(/[?.,!]/g, "");
                if (result.includes(target)) {
                    hasSucceeded = true;
                    recognition.stop();
                    handleSuccess();
                }
            };

            recognition.onend = () => {
                isProcessing = false;
                document.getElementById('mic-button').classList.remove('is-listening');
                document.getElementById('main-card').classList.remove('listening-active');
            };
        }

        function startGame() {
            document.getElementById('start-overlay').style.display = 'none';
            updateCard();
        }

        function updateCard() {
            hasSucceeded = false;
            window.speechSynthesis.cancel();
            if (isProcessing) recognition.stop();
            
            const item = words[currentIndex];
            document.getElementById('display-emoji').innerText = item.icon;
            document.getElementById('display-en').innerText = item.en;
            document.getElementById('counter').innerText = `${currentIndex + 1} / ${words.length}`;
            document.getElementById('transcript-text').innerText = "";
            
            setTimeout(() => speak(item.en), 300);
        }

        function toggleMic() {
            if (isProcessing) recognition.stop();
            else startListening();
        }

        function startListening() {
            if (!recognition || isProcessing) return;
            hasSucceeded = false;
            try {
                recognition.start();
            } catch(e) { console.log("Recognition error:", e); }
        }

        function handleSuccess() {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            playWinSound();
            setTimeout(nextWord, 2000);
        }

        function playWinSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            [523, 659, 783, 1046].forEach((f, i) => {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.frequency.setValueAtTime(f, audioCtx.currentTime + i * 0.1);
                g.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.1);
                o.connect(g); g.connect(audioCtx.destination);
                o.start(audioCtx.currentTime + i * 0.1); o.stop(audioCtx.currentTime + i * 0.1 + 0.3);
            });
        }

        function speak(text) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'en-US';
            u.rate = 0.8;
            u.onend = () => {
                // ×”×©×”×™×” ×©×œ 500 ××™×œ×™×©× ×™×•×ª ×œ×¤× ×™ ×©×¤×•×ª×—×™× ××™×§×¨×•×¤×•×Ÿ ×›×“×™ ×œ×× ×•×¢ ×§×¨×™×¡×” ×‘×˜×œ×¤×•×Ÿ
                setTimeout(startListening, 500);
            };
            window.speechSynthesis.speak(u);
        }

        function nextWord() { currentIndex = (currentIndex + 1) % words.length; updateCard(); }
        function prevWord() { currentIndex = (currentIndex - 1 + words.length) % words.length; updateCard(); }
    </script>
</body>
</html>
