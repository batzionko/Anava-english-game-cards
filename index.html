<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Magic Game âœ¨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #fdf2f8; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; overflow: hidden; }
        
        /* ××•× ×” ××™×œ×™× */
        .counter { font-size: 22px; color: #db2777; margin-bottom: 15px; font-weight: bold; background: white; padding: 5px 20px; border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* ×”×›×¨×˜×™×¡ ×”××¨×›×–×™ */
        .card { width: 340px; height: 420px; background: white; border-radius: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; justify-content: center; border: 10px solid #fbcfe8; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; }
        .listening-active { border-color: #60a5fa !important; box-shadow: 0 0 40px rgba(59, 130, 246, 0.6); transform: scale(1.02); }
        
        .emoji { font-size: 110px; margin-bottom: 15px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.1)); }
        .en-word { font-size: 34px; font-weight: 900; color: #be185d; direction: ltr; text-align: center; line-height: 1.2; padding: 0 15px; }
        
        .transcript-display { margin-top: 20px; height: 30px; color: #3b82f6; font-weight: bold; font-size: 20px; text-align: center; width: 90%; }
        .status-light { width: 45px; height: 45px; border-radius: 50%; background: #e5e7eb; margin-top: 20px; border: 4px solid white; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }

        /* ××–×•×¨ ×”×›×¤×ª×•×¨×™× */
        .controls { margin-top: 40px; display: flex; gap: 25px; align-items: center; direction: ltr; }

        /* ×¢×™×¦×•×‘ ×›×¤×ª×•×¨×™× ×›×œ×œ×™ */
        .btn { border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; position: relative; outline: none; -webkit-tap-highlight-color: transparent; }
        .btn:active { transform: translateY(6px); box-shadow: none !important; }

        /* ×›×¤×ª×•×¨×™ ×—×™×¦×™× */
        .nav-btn { width: 80px; height: 80px; background: #f472b6; color: white; border-radius: 25px; font-size: 35px; box-shadow: 0 8px 0 #db2777; }
        
        /* ×›×¤×ª×•×¨ ××™×§×¨×•×¤×•×Ÿ ×¢× ×§ */
        .mic-btn { width: 110px; height: 110px; background: #3b82f6; color: white; border-radius: 50%; font-size: 50px; box-shadow: 0 10px 0 #1d4ed8; }
        .mic-btn.is-listening { background: #fbbf24; box-shadow: 0 10px 0 #d97706; animation: pulse 1.2s infinite; }

        @keyframes pulse { 0% { transform: scale(1); box-shadow: 0 10px 0 #d97706, 0 0 0 0px rgba(251, 191, 36, 0.7); } 70% { transform: scale(1.05); box-shadow: 0 10px 0 #d97706, 0 0 0 20px rgba(251, 191, 36, 0); } 100% { transform: scale(1); box-shadow: 0 10px 0 #d97706, 0 0 0 0px rgba(251, 191, 36, 0); } }
    </style>
</head>
<body>

    <div class="counter" id="counter">1 / 40</div>

    <div class="card" id="main-card">
        <div class="emoji" id="display-emoji">ğŸ‘‹</div>
        <div class="en-word" id="display-en">Welcome</div>
        <div class="transcript-display" id="transcript-text">××•×›× ×”?</div>
        <div id="status" class="status-light"></div>
    </div>

    <div class="controls">
        <button class="btn nav-btn" onclick="prevWord()">â¬…ï¸</button>
        <button id="mic-button" class="btn mic-btn" onclick="startListening()">ğŸ¤</button>
        <button class="btn nav-btn" onclick="nextWord()">â¡ï¸</button>
    </div>

    <script>
        const words = [
            { en: 'Welcome', icon: 'ğŸ‘‹' }, { en: 'Hello', icon: 'ğŸ˜Š' }, { en: 'Good afternoon', icon: 'â˜€ï¸' },
            { en: 'Thank you', icon: 'ğŸ™' }, { en: "What's your name?", icon: 'â“' }, { en: 'My name is', icon: 'ğŸ†”' },
            { en: 'Sunday', icon: 'ğŸ“…' }, { en: 'Yes', icon: 'âœ…' }, { en: 'No', icon: 'âŒ' },
            { en: 'OK', icon: 'ğŸ†—' }, { en: 'Goodbye', icon: 'ğŸ‘‹' }, { en: 'How are you today?', icon: 'ğŸ’–' },
            { en: "Thank you I'm Ok", icon: 'ğŸ‘' }, { en: 'I love you', icon: 'ğŸ¤Ÿ' }, { en: 'Colors', icon: 'ğŸ¨' },
            { en: 'Red', icon: 'â™¥ï¸' }, { en: 'Green', icon: 'ğŸ’š' }, { en: 'Pink', icon: 'ğŸ’—' },
            { en: 'Blue', icon: 'ğŸ’™' }, { en: 'Light blue', icon: 'ğŸ©µ' }, { en: 'Orange', icon: 'ğŸ§¡' },
            { en: 'Gray', icon: 'ğŸ”˜' }, { en: 'Brown', icon: 'ğŸ¤' }, { en: 'Purple', icon: 'ğŸ’œ' },
            { en: 'White', icon: 'ğŸ¤' }, { en: 'Black', icon: 'ğŸ–¤' }, { en: 'Animals', icon: 'ğŸ¦' },
            { en: 'Cat', icon: 'ğŸˆ' }, { en: 'Dog', icon: 'ğŸ•' }, { en: 'Monkey', icon: 'ğŸ’' },
            { en: 'Frog', icon: 'ğŸ¸' }, { en: 'Snake', icon: 'ğŸ' }, { en: 'Rabbit', icon: 'ğŸ°' },
            { en: 'Cow', icon: 'ğŸ„' }, { en: 'Fish', icon: 'ğŸŸ' }, { en: 'Shark', icon: 'ğŸ¦ˆ' },
            { en: 'Dreidel', icon: 'ğŸ•' }, { en: 'Dance', icon: 'ğŸ’ƒ' }, { en: 'Jump', icon: 'ğŸ¦˜' },
            { en: 'Stop', icon: 'ğŸ›‘' }, { en: 'Party', icon: 'ğŸ‰' }, { en: 'Light', icon: 'ğŸ’¡' }
        ];

        let currentIndex = 0;
        let isProcessing = false;
        let micTimeout;
        let hasSucceeded = false;

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = true;
        recognition.continuous = true;

        function updateCard() {
            hasSucceeded = false;
            const item = words[currentIndex];
            document.getElementById('display-emoji').innerText = item.icon;
            document.getElementById('display-en').innerText = item.en;
            document.getElementById('counter').innerText = `${currentIndex + 1} / ${words.length}`;
            document.getElementById('status').style.backgroundColor = '#e5e7eb';
            document.getElementById('transcript-text').innerText = "×œ×—×¦×™ ×¢×œ ×”××™×§×¨×•×¤×•×Ÿ";
            document.getElementById('transcript-text').style.color = "#3b82f6";
            speak(item.en);
        }

        function startListening() {
            if (isProcessing) return;
            hasSucceeded = false;
            try {
                recognition.start();
                clearTimeout(micTimeout);
                micTimeout = setTimeout(() => {
                    if (isProcessing && !hasSucceeded) {
                        recognition.stop();
                        handleTimeout();
                    }
                }, 10000);
            } catch (e) {}
        }

        recognition.onstart = () => {
            isProcessing = true;
            document.getElementById('mic-button').classList.add('is-listening');
            document.getElementById('main-card').classList.add('listening-active');
            document.getElementById('transcript-text').innerText = "×× ×™ ××§×©×™×‘×”...";
        };

        recognition.onresult = (event) => {
            if (hasSucceeded) return;
            let result = "";
            for (let i = event.resultIndex; i < event.results.length; ++i) {
                result += event.results[i][0].transcript;
            }
            result = result.toLowerCase().trim();
            document.getElementById('transcript-text').innerText = `×©××¢×ª×™: ${result}`;
            
            const target = words[currentIndex].en.toLowerCase().replace(/[?.,!]/g, "");
            if (result.includes(target)) {
                hasSucceeded = true;
                clearTimeout(micTimeout);
                recognition.stop();
                handleSuccess();
            }
        };

        function handleTimeout() {
            if (hasSucceeded) return;
            stopUI();
            document.getElementById('transcript-text').innerText = "×œ× ×©××¢×ª×™, × ×¡×™ ×©×•×‘";
            document.getElementById('transcript-text').style.color = "#f59e0b";
        }

        function stopUI() {
            isProcessing = false;
            document.getElementById('mic-button').classList.remove('is-listening');
            document.getElementById('main-card').classList.remove('listening-active');
        }

        recognition.onend = () => stopUI();

        function handleSuccess() {
            document.getElementById('status').style.backgroundColor = '#10b981';
            document.getElementById('transcript-text').innerText = "× ×›×•×Ÿ ×××•×“! âœ¨";
            document.getElementById('transcript-text').style.color = "#10b981";
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            playSuccessSound();
            setTimeout(nextWord, 2500);
        }

        function playSuccessSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const notes = [523.25, 659.25, 783.99, 1046.50];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.4);
            });
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'en-US';
            u.rate = 0.8;
            window.speechSynthesis.speak(u);
        }

        function nextWord() { currentIndex = (currentIndex + 1) % words.length; updateCard(); }
        function prevWord() { currentIndex = (currentIndex - 1 + words.length) % words.length; updateCard(); }

        updateCard();
    </script>
</body>
</html>