<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Magic World âœ¨</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --pink: #fdf2f8; --dark-pink: #be185d; --blue: #3b82f6; --purple: #a855f7; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--pink); display: flex; flex-direction: column; align-items: center; justify-content: flex-start; min-height: 100vh; margin: 0; overflow: hidden; box-sizing: border-box; }
        #menu-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 20px; height: 100vh; width: 100%; background: linear-gradient(180deg, #fdf2f8 0%, #fae8ff 100%); }
        .menu-title { font-size: 45px; color: var(--dark-pink); margin: 0; text-shadow: 3px 3px 0px white; animation: float 3s ease-in-out infinite; }
        .menu-btn { width: 300px; height: 130px; border-radius: 60px; border: none; font-size: 26px; font-weight: 900; cursor: pointer; color: white; transition: 0.3s; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1.2; text-align: center; padding: 10px; }
        .btn-game-1 { background: var(--blue); box-shadow: 0 12px 0 #1d4ed8; }
        .btn-game-2 { background: var(--purple); box-shadow: 0 12px 0 #7e22ce; }
        .menu-btn:active { transform: translateY(8px); box-shadow: none; }
        .btn-subtext { font-size: 18px; font-weight: bold; background: rgba(255,255,255,0.2); padding: 2px 15px; border-radius: 15px; margin-top: 8px; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        #game-screen { display: none; flex-direction: column; align-items: center; width: 100%; padding-top: 20px; }
        .counter-container { display: flex; gap: 10px; margin-bottom: 8px; }
        .counter { font-size: 18px; color: #ad1457; font-weight: bold; background: white; padding: 5px 15px; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .success-streak { background: #dcfce7; color: #166534; }
        .card { width: 310px; height: 370px; background: white; border-radius: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); display: flex; flex-direction: column; align-items: center; justify-content: center; border: 12px solid #fbcfe8; position: relative; }
        .listening-active { border-color: #fbbf24 !important; box-shadow: 0 0 30px rgba(251, 191, 36, 0.7); }
        .emoji { font-size: 85px; margin-bottom: 10px; }
        .en-word { font-size: 28px; font-weight: 900; color: var(--dark-pink); direction: ltr; text-align: center; width: 90%; }
        .instruction { font-size: 20px; color: #666; margin-bottom: 5px; font-weight: bold; }
        .transcript { margin-top: 15px; color: var(--blue); font-weight: bold; min-height: 24px; font-size: 20px; }
        .controls { margin-top: 25px; display: flex; gap: 20px; align-items: center; direction: ltr; }
        .nav-btn { width: 70px; height: 70px; background: #f472b6; font-size: 35px; border-radius: 25px; box-shadow: 0 8px 0 #db2777; border: none; cursor: pointer; color: white; }
        .mic-btn { width: 95px; height: 95px; background: var(--blue); border-radius: 50%; font-size: 45px; box-shadow: 0 10px 0 #1d4ed8; border: none; cursor: pointer; color: white; }
        .mic-btn.is-listening { background: #fbbf24; box-shadow: 0 10px 0 #d97706; animation: pulse 1s infinite; }
        .home-btn { position: absolute; top: 15px; right: 15px; background: white; width: 50px; height: 50px; font-size: 25px; border-radius: 15px; box-shadow: 0 4px 0 #ddd; border: none; cursor: pointer; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.08); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="menu-screen">
        <h1 class="menu-title">×§×¡× ×”×× ×’×œ×™×ª âœ¨</h1>
        <button class="menu-btn btn-game-1" onclick="initAudio(); startApp(1)">
            ×“×‘×¨×™ ×‘×× ×’×œ×™×ª ğŸ¤
            <span class="btn-subtext">×ª×—×–×¨×• ××—×¨×™×™!</span>
        </button>
        <button class="menu-btn btn-game-2" onclick="initAudio(); startApp(2)">
            ×ª×¨×’×•× ×œ×¢×‘×¨×™×ª ğŸ§ 
            <span class="btn-subtext">××™×š ××•××¨×™×?</span>
        </button>
    </div>

    <div id="game-screen">
        <button class="home-btn" onclick="goToMenu()">ğŸ </button>
        <div class="counter-container">
            <div class="counter" id="counter">1 / 42</div>
            <div class="counter success-streak" id="streak-counter">×”×¦×œ×—×•×ª: 0</div>
        </div>
        <div class="card" id="main-card">
            <div id="game-instruction" class="instruction"></div>
            <div class="emoji" id="display-emoji">ğŸ‘‹</div>
            <div class="en-word" id="display-en">Welcome</div>
            <div class="transcript" id="transcript-text"></div>
        </div>
        <div class="controls">
            <button class="nav-btn" onclick="prevWord()">â¬…ï¸</button>
            <button id="mic-button" class="mic-btn" onclick="toggleMic()">ğŸ¤</button>
            <button class="nav-btn" onclick="nextWord()">â¡ï¸</button>
        </div>
    </div>

    <script>
        const words = [
            { en: 'Welcome', hb: '×‘×¨×•×›×™× ×”×‘××™×', icon: 'ğŸ‘‹' }, { en: 'Hello', hb: '×©×œ×•×', icon: 'ğŸ˜Š' },
            { en: 'Good afternoon', hb: '×¦×”×¨×™×™× ×˜×•×‘×™×', icon: 'â˜€ï¸' }, { en: 'Thank you', hb: '×ª×•×“×”', icon: 'ğŸ™' },
            { en: "What's your name?", hb: '××” ×”×©× ×©×œ×š', icon: 'â“' }, { en: 'My name is', hb: '×”×©× ×©×œ×™', icon: 'ğŸ†”' },
            { en: 'Sunday', hb: '×™×•× ×¨××©×•×Ÿ', icon: 'ğŸ“…' }, { en: 'Yes', hb: '×›×Ÿ', icon: 'âœ…' },
            { en: 'No', hb: '×œ×', icon: 'âŒ' }, { en: 'OK', hb: '××•×§×™×™', icon: 'ğŸ†—' },
            { en: 'Goodbye', hb: '×œ×”×ª×¨××•×ª', icon: 'ğŸ‘‹' }, { en: 'How are you today?', hb: '××” ×©×œ×•××š ×”×™×•×', icon: 'ğŸ’–' },
            { en: "Thank you I'm Ok", hb: '×ª×•×“×” ×× ×™ ×‘×¡×“×¨', icon: 'ğŸ‘' }, { en: 'I love you', hb: '×× ×™ ××•×”×‘ ××•×ª×š', icon: 'ğŸ¤Ÿ' },
            { en: 'Red', hb: '××“×•×', icon: 'ğŸ”´' }, { en: 'Green', hb: '×™×¨×•×§', icon: 'ğŸŸ¢' },
            { en: 'Pink', hb: '×•×¨×•×“', icon: 'ğŸ’—' }, { en: 'Blue', hb: '×›×—×•×œ', icon: 'ğŸ”µ' },
            { en: 'Light blue', hb: '×ª×›×œ×ª', icon: 'ğŸ©µ' }, { en: 'Orange', hb: '×›×ª×•×', icon: 'ğŸ§¡' },
            { en: 'Gray', hb: '××¤×•×¨', icon: 'ğŸ”˜' }, { en: 'Brown', hb: '×—×•×', icon: 'ğŸ¤' },
            { en: 'Purple', hb: '×¡×’×•×œ', icon: 'ğŸ’œ' }, { en: 'White', hb: '×œ×‘×Ÿ', icon: 'ğŸ¤' },
            { en: 'Black', hb: '×©×—×•×¨', icon: 'ğŸ–¤' }, { en: 'Cat', hb: '×—×ª×•×œ', icon: 'ğŸˆ' },
            { en: 'Dog', hb: '×›×œ×‘', icon: 'ğŸ•' }, { en: 'Monkey', hb: '×§×•×£', icon: 'ğŸ’' },
            { en: 'Frog', hb: '×¦×¤×¨×“×¢', icon: 'ğŸ¸' }, { en: 'Snake', hb: '× ×—×©', icon: 'ğŸ' },
            { en: 'Rabbit', hb: '××¨× ×‘', icon: 'ğŸ°' }, { en: 'Cow', hb: '×¤×¨×”', icon: 'ğŸ„' },
            { en: 'Fish', hb: '×“×’', icon: 'ğŸŸ' }, { en: 'Shark', hb: '×›×¨×™×©', icon: 'ğŸ¦ˆ' },
            { en: 'Dreidel', hb: '×¡×‘×™×‘×•×Ÿ', icon: 'ğŸŒ€' }, { en: 'Dance', hb: '×œ×¨×§×•×“', icon: 'ğŸ’ƒ' },
            { en: 'Jump', hb: '×œ×§×¤×•×¥', icon: 'ğŸ¦˜' }, { en: 'Stop', hb: '×œ×¢×¦×•×¨', icon: 'ğŸ›‘' },
            { en: 'Party', hb: '××¡×™×‘×”', icon: 'ğŸ‰' }, { en: 'Light', hb: '××•×¨', icon: 'ğŸ’¡' },
            { en: 'Happy birthday', hb: '×™×•× ×”×•×œ×“×ª ×©××—', icon: 'ğŸ‚' }, { en: 'Good morning', hb: '×‘×•×§×¨ ×˜×•×‘', icon: 'ğŸŒ…' }
        ];

        let currentIndex = 0;
        let successCount = 0;
        let currentGameMode = 1; 
        let isProcessing = false;
        let hasSucceeded = false;
        let recognition;
        let silenceTimer;
        let audioCtx;

        const compliments = [
            "Very Good!",
            "You are Excellent!",
            "Amazing job!",
            "You are a superstar!",
            "Fantastic!",
            "Great work!"
        ];

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.interimResults = true;
            recognition.continuous = false; 

            recognition.onstart = () => {
                isProcessing = true;
                document.getElementById('mic-button').classList.add('is-listening');
                document.getElementById('main-card').classList.add('listening-active');
                
                clearTimeout(silenceTimer);
                silenceTimer = setTimeout(() => {
                    if (isProcessing && !hasSucceeded) {
                        recognition.stop(); 
                    }
                }, 7000); 
            };

            recognition.onresult = (event) => {
                if (hasSucceeded) return;
                let result = "";
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    result += event.results[i][0].transcript;
                }
                result = result.toLowerCase().trim();
                document.getElementById('transcript-text').innerText = result;
                
                const target = (currentGameMode === 1) ? words[currentIndex].en.toLowerCase().replace(/[?.,!]/g, "") : words[currentIndex].hb;
                
                if (result.includes(target)) {
                    hasSucceeded = true;
                    clearTimeout(silenceTimer);
                    recognition.stop();
                    handleSuccess();
                }
            };

            recognition.onend = () => {
                isProcessing = false;
                document.getElementById('mic-button').classList.remove('is-listening');
                document.getElementById('main-card').classList.remove('listening-active');
                
                if (!hasSucceeded && document.getElementById('game-screen').style.display === 'flex') {
                    playFailSound(); 
                    setTimeout(speakCurrentWord, 800); 
                }
            };
        }

        function startApp(mode) {
            currentGameMode = mode;
            currentIndex = 0;
            successCount = 0;
            updateCounters();
            recognition.lang = (mode === 1) ? 'en-US' : 'he-IL';
            document.getElementById('game-instruction').innerText = (mode === 1) ? "×ª×—×–×¨×• ××—×¨×™×™!" : "××™×š ××•××¨×™× ×‘×¢×‘×¨×™×ª?";
            document.getElementById('menu-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            
            const introMsg = (mode === 1) ? "×‘×•××• × ×“×‘×¨ ×‘×× ×’×œ×™×ª, ×ª×—×–×¨×• ××—×¨×™×™" : "×‘×•××• × ×ª×¨×’×, ××™×š ××•××¨×™× ×‘×¢×‘×¨×™×ª?";
            const u = new SpeechSynthesisUtterance(introMsg);
            u.lang = 'he-IL';
            u.onend = () => updateCard();
            window.speechSynthesis.speak(u);
        }

        function goToMenu() {
            hasSucceeded = true; 
            clearTimeout(silenceTimer);
            window.speechSynthesis.cancel();
            if(isProcessing) recognition.stop();
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'flex';
        }

        function updateCard() {
            hasSucceeded = false;
            document.getElementById('transcript-text').innerText = "";
            const item = words[currentIndex];
            document.getElementById('display-emoji').innerText = item.icon;
            document.getElementById('display-en').innerText = item.en;
            updateCounters();
            speakCurrentWord();
        }

        function updateCounters() {
            document.getElementById('counter').innerText = `${currentIndex + 1} / ${words.length}`;
            document.getElementById('streak-counter').innerText = `×”×¦×œ×—×•×ª: ${successCount}`;
        }

        function speakCurrentWord() {
            if (hasSucceeded) return;
            window.speechSynthesis.cancel();
            
            const item = words[currentIndex];
            let textToSay = (currentGameMode === 1) ? item.en : `How do you say ${item.en} in Hebrew?`;
            
            const u = new SpeechSynthesisUtterance(textToSay);
            u.lang = 'en-US';
            u.rate = 0.8;
            u.onend = () => {
                if (!hasSucceeded) startListening();
            };
            window.speechSynthesis.speak(u);
        }

        function toggleMic() {
            initAudio(); 
            if (isProcessing) recognition.stop();
            else startListening();
        }

        function startListening() {
            if (!recognition || isProcessing || hasSucceeded) return;
            try { recognition.start(); } catch(e) {}
        }

        function handleSuccess() {
            successCount++;
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            playWinSound();
            
            if (successCount % 5 === 0) {
                setTimeout(giveCompliment, 1000);
            } else {
                setTimeout(nextWord, 2000);
            }
        }

        function giveCompliment() {
            window.speechSynthesis.cancel();
            const randomCompliment = compliments[Math.floor(Math.random() * compliments.length)];
            const u = new SpeechSynthesisUtterance(randomCompliment);
            u.lang = 'en-US';
            u.pitch = 1.2;
            u.rate = 0.9;
            u.onend = () => setTimeout(nextWord, 1000);
            window.speechSynthesis.speak(u);
        }

        function playWinSound() {
            if (!audioCtx) return;
            [523, 659, 783, 1046].forEach((f, i) => {
                const o = audioCtx.createOscillator();
                o.type = 'sine';
                o.frequency.setValueAtTime(f, audioCtx.currentTime + i * 0.1);
                const g = audioCtx.createGain();
                g.gain.setValueAtTime(0.05, audioCtx.currentTime);
                o.connect(g); g.connect(audioCtx.destination);
                o.start(audioCtx.currentTime + i * 0.1); o.stop(audioCtx.currentTime + i * 0.1 + 0.2);
            });
        }

        function playFailSound() {
            if (!audioCtx) return;
            const now = audioCtx.currentTime;
            const playTick = (time, freq) => {
                const o = audioCtx.createOscillator();
                o.type = 'sine';
                o.frequency.setValueAtTime(freq, time);
                const g = audioCtx.createGain();
                g.gain.setValueAtTime(0.05, time);
                g.gain.exponentialRampToValueAtTime(0.001, time + 0.1);
                o.connect(g); g.connect(audioCtx.destination);
                o.start(time); o.stop(time + 0.1);
            }
            playTick(now, 800);
            playTick(now + 0.15, 600);
        }

        function nextWord() { 
            currentIndex = (currentIndex + 1) % words.length; 
            updateCard(); 
        }
        function prevWord() { 
            currentIndex = (currentIndex - 1 + words.length) % words.length; 
            updateCard(); 
        }
    </script>
</body>
</html>